## ggplot version
plot_pix_gg <- function(pix, obs) {
px <- as.character(pix)
pxv <- paste("V",as.character(pix), sep = "")
#base
med.base <- med.pred.base %>% as.data.frame()
med.base$year <- row.names(med.base)
med <- med.base %>% mutate(year = as.numeric(year)+1985) %>%
pivot_longer(!year, values_to = "med.pred.base", names_to = "pixel") %>%
filter(pixel == pxv) %>% dplyr::select(-pixel) %>%
filter(year != 1986) # remove first year (true value, not part of the forecast)
low.base <- low.pred.base %>% as.data.frame() # low
low.base$year <- row.names(low.base)
low <- low.base %>% mutate(year = as.numeric(year)+1985) %>%
pivot_longer(!year, values_to = "low.pred.base", names_to = "pixel") %>%
filter(pixel == pxv) %>% dplyr::select(-pixel) %>%
filter(year != 1) # remove first year (true value, not part of the forecast)
up.base <- up.pred.base %>% as.data.frame() # high
up.base$year <- row.names(up.base)
up <- up.base %>% mutate(year = as.numeric(year)+1985) %>%
pivot_longer(!year, values_to = "up.pred.base", names_to = "pixel") %>%
filter(pixel == pxv) %>% dplyr::select(-pixel) %>%
filter(year != 1986) # remove first year (true value, not part of the forecast)
#clim
med.clim <- med.pred.clim %>% as.data.frame()
med.clim$year <- row.names(med.clim)
med.clim <- med.clim %>% mutate(year = as.numeric(year)+1985) %>%
pivot_longer(!year, values_to = "med.pred.clim", names_to = "pixel") %>%
filter(pixel == pxv) %>% dplyr::select(-pixel) %>%
filter(year != 1986) # remove first year (true value, not part of the forecast)
low.clim <- low.pred.clim %>% as.data.frame() # low
low.clim$year <- row.names(low.clim)
low.clim <- low.clim %>% mutate(year = as.numeric(year)+1985) %>%
pivot_longer(!year, values_to = "low.pred.clim", names_to = "pixel") %>%
filter(pixel == pxv) %>% dplyr::select(-pixel) %>%
filter(year != 1986) # remove first year (true value, not part of the forecast)
up.clim <- up.pred.clim %>% as.data.frame()  # high
up.clim$year <- row.names(up.clim)
up.clim <- up.clim %>% mutate(year = as.numeric(year)+1985) %>%
pivot_longer(!year, values_to = "up.pred.clim", names_to = "pixel") %>%
filter(pixel == pxv) %>% dplyr::select(-pixel) %>%
filter(year != 1986) # remove first year (true value, not part of the forecast)
# observed
Ndat <- obs %>% as.data.frame() %>% rownames_to_column("year") %>%
pivot_longer(!year, values_to = "obs", names_to = "pixel") %>%
filter(pixel == px) %>%
mutate(year = as.numeric(year)+1985) %>%
dplyr::select(-pixel)
# combine predictions and observations into one dataframe
plot.dat <- left_join(Ndat, med) %>% left_join(.,low) %>% left_join(.,up) %>% left_join(.,up.clim) %>% left_join(.,low.clim) %>% left_join(.,med.clim)
## plot
# color palette
cols = c('base' = '#F8766D', 'climate-only' = '#00BFC4')
(plot.dat %>%
ggplot(aes(x = year, y = obs)) +
geom_point(aes(x = year, y = obs, shape = "observations"), fill = 'black') + geom_line(aes(x = year, y = obs), lty = 2) +
geom_ribbon(aes(ymin = low.pred.base, ymax = up.pred.base, fill = "base"),
alpha=0.4) +
geom_ribbon(aes(ymin = low.pred.clim, ymax = up.pred.clim, fill = "climate-only"),
alpha=0.3) +
geom_line(aes(x = year, y = med.pred.base, col = "base"), lwd = 1.5) +
geom_line(aes(x = year, y = med.pred.clim, col = "climate-only"), lwd = 1.5) +
scale_y_continuous(limits = c(-5, 30)) +
scale_color_manual(name = '', values = cols) +
scale_fill_manual(name = '', values = cols) +
scale_shape_manual(name = '', values = 21, labels = 'observations') +
labs(x = "YEAR", y = "TREE COVER (%)") +
theme(
legend.justification = c("left", "top"),
legend.position = c(.99, .99),
legend.title=element_blank(),
legend.spacing.y = unit(-.2, 'cm'),
legend.box.margin = margin(4,4,4,4),
legend.key=element_blank(),
legend.key.size = unit(0.5, 'cm'),
legend.text=element_text(size=10),
text = element_text(size=18),
panel.background = element_rect(linetype = "solid",fill = NA),
panel.border = element_rect(linetype = "solid", fill = NA))
)
}
# plot low, medium, and high cover all-together
plot_grid(plot_pix_gg(1530, N),
plot_pix_gg(152, N) + theme(legend.position = "none") + labs(y = ''),
plot_pix_gg(120, N) + theme(legend.position = "none") + labs(y = ''), ncol = 3)
# ----------------- Plot predictions over time ------------------
## ggplot version
plot_pix_gg <- function(pix, obs) {
px <- as.character(pix)
pxv <- paste("V",as.character(pix), sep = "")
#base
med.base <- med.pred.base %>% as.data.frame()
med.base$year <- row.names(med.base)
med <- med.base %>% mutate(year = as.numeric(year)+1985) %>%
pivot_longer(!year, values_to = "med.pred.base", names_to = "pixel") %>%
filter(pixel == pxv) %>% dplyr::select(-pixel) %>%
filter(year != 1986) # remove first year (true value, not part of the forecast)
low.base <- low.pred.base %>% as.data.frame() # low
low.base$year <- row.names(low.base)
low <- low.base %>% mutate(year = as.numeric(year)+1985) %>%
pivot_longer(!year, values_to = "low.pred.base", names_to = "pixel") %>%
filter(pixel == pxv) %>% dplyr::select(-pixel) %>%
filter(year != 1) # remove first year (true value, not part of the forecast)
up.base <- up.pred.base %>% as.data.frame() # high
up.base$year <- row.names(up.base)
up <- up.base %>% mutate(year = as.numeric(year)+1985) %>%
pivot_longer(!year, values_to = "up.pred.base", names_to = "pixel") %>%
filter(pixel == pxv) %>% dplyr::select(-pixel) %>%
filter(year != 1986) # remove first year (true value, not part of the forecast)
#clim
med.clim <- med.pred.clim %>% as.data.frame()
med.clim$year <- row.names(med.clim)
med.clim <- med.clim %>% mutate(year = as.numeric(year)+1985) %>%
pivot_longer(!year, values_to = "med.pred.clim", names_to = "pixel") %>%
filter(pixel == pxv) %>% dplyr::select(-pixel) %>%
filter(year != 1986) # remove first year (true value, not part of the forecast)
low.clim <- low.pred.clim %>% as.data.frame() # low
low.clim$year <- row.names(low.clim)
low.clim <- low.clim %>% mutate(year = as.numeric(year)+1985) %>%
pivot_longer(!year, values_to = "low.pred.clim", names_to = "pixel") %>%
filter(pixel == pxv) %>% dplyr::select(-pixel) %>%
filter(year != 1986) # remove first year (true value, not part of the forecast)
up.clim <- up.pred.clim %>% as.data.frame()  # high
up.clim$year <- row.names(up.clim)
up.clim <- up.clim %>% mutate(year = as.numeric(year)+1985) %>%
pivot_longer(!year, values_to = "up.pred.clim", names_to = "pixel") %>%
filter(pixel == pxv) %>% dplyr::select(-pixel) %>%
filter(year != 1986) # remove first year (true value, not part of the forecast)
# observed
Ndat <- obs %>% as.data.frame() %>% rownames_to_column("year") %>%
pivot_longer(!year, values_to = "obs", names_to = "pixel") %>%
filter(pixel == px) %>%
mutate(year = as.numeric(year)+1985) %>%
dplyr::select(-pixel)
# combine predictions and observations into one dataframe
plot.dat <- left_join(Ndat, med) %>% left_join(.,low) %>% left_join(.,up) %>% left_join(.,up.clim) %>% left_join(.,low.clim) %>% left_join(.,med.clim)
## plot
# color palette
cols = c('base' = '#F8766D', 'climate-only' = '#00BFC4')
(plot.dat %>%
ggplot(aes(x = year, y = obs)) +
geom_point(aes(x = year, y = obs, shape = "observations"), fill = 'black') + geom_line(aes(x = year, y = obs), lty = 2) +
geom_ribbon(aes(ymin = low.pred.base, ymax = up.pred.base, fill = "base"),
alpha=0.4) +
geom_ribbon(aes(ymin = low.pred.clim, ymax = up.pred.clim, fill = "climate-only"),
alpha=0.3) +
geom_line(aes(x = year, y = med.pred.base, col = "base"), lwd = 1.5) +
geom_line(aes(x = year, y = med.pred.clim, col = "climate-only"), lwd = 1.5) +
scale_y_continuous(limits = c(-5, 30)) +
scale_color_manual(name = '', values = cols) +
scale_fill_manual(name = '', values = cols) +
scale_shape_manual(name = '', values = 21, labels = 'observations') +
labs(x = "YEAR", y = "TREE COVER (%)") +
theme(
legend.justification = c("right", "top"),
legend.position = c(.99, .99),
legend.title=element_blank(),
legend.spacing.y = unit(-.2, 'cm'),
legend.box.margin = margin(4,4,4,4),
legend.key=element_blank(),
legend.key.size = unit(0.5, 'cm'),
legend.text=element_text(size=10),
text = element_text(size=18),
panel.background = element_rect(linetype = "solid",fill = NA),
panel.border = element_rect(linetype = "solid", fill = NA))
)
}
# plot low, medium, and high cover all-together
plot_grid(plot_pix_gg(1530, N),
plot_pix_gg(152, N) + theme(legend.position = "none") + labs(y = ''),
plot_pix_gg(120, N) + theme(legend.position = "none") + labs(y = ''), ncol = 3)
ggsave("R:/Shriver_Lab/PJspread/evaluate_out_of_sample/35y_insample_predictions/single_pixel_low_mid_high_cover_5yr_avg_init.png", plot = last_plot(), dpi = 400)
# test plot function for a given pixel
plot_pix_gg(707, N)
# plot low, medium, and high cover all-together
plot_grid(plot_pix_gg(707, N),
plot_pix_gg(152, N) + theme(legend.position = "none") + labs(y = ''),
plot_pix_gg(120, N) + theme(legend.position = "none") + labs(y = ''), ncol = 3)
# ----------------- Plot predictions over time ------------------
## ggplot version
plot_pix_gg <- function(pix, obs) {
px <- as.character(pix)
pxv <- paste("V",as.character(pix), sep = "")
#base
med.base <- med.pred.base %>% as.data.frame()
med.base$year <- row.names(med.base)
med <- med.base %>% mutate(year = as.numeric(year)+1985) %>%
pivot_longer(!year, values_to = "med.pred.base", names_to = "pixel") %>%
filter(pixel == pxv) %>% dplyr::select(-pixel) %>%
filter(year != 1986) # remove first year (true value, not part of the forecast)
low.base <- low.pred.base %>% as.data.frame() # low
low.base$year <- row.names(low.base)
low <- low.base %>% mutate(year = as.numeric(year)+1985) %>%
pivot_longer(!year, values_to = "low.pred.base", names_to = "pixel") %>%
filter(pixel == pxv) %>% dplyr::select(-pixel) %>%
filter(year != 1) # remove first year (true value, not part of the forecast)
up.base <- up.pred.base %>% as.data.frame() # high
up.base$year <- row.names(up.base)
up <- up.base %>% mutate(year = as.numeric(year)+1985) %>%
pivot_longer(!year, values_to = "up.pred.base", names_to = "pixel") %>%
filter(pixel == pxv) %>% dplyr::select(-pixel) %>%
filter(year != 1986) # remove first year (true value, not part of the forecast)
#clim
med.clim <- med.pred.clim %>% as.data.frame()
med.clim$year <- row.names(med.clim)
med.clim <- med.clim %>% mutate(year = as.numeric(year)+1985) %>%
pivot_longer(!year, values_to = "med.pred.clim", names_to = "pixel") %>%
filter(pixel == pxv) %>% dplyr::select(-pixel) %>%
filter(year != 1986) # remove first year (true value, not part of the forecast)
low.clim <- low.pred.clim %>% as.data.frame() # low
low.clim$year <- row.names(low.clim)
low.clim <- low.clim %>% mutate(year = as.numeric(year)+1985) %>%
pivot_longer(!year, values_to = "low.pred.clim", names_to = "pixel") %>%
filter(pixel == pxv) %>% dplyr::select(-pixel) %>%
filter(year != 1986) # remove first year (true value, not part of the forecast)
up.clim <- up.pred.clim %>% as.data.frame()  # high
up.clim$year <- row.names(up.clim)
up.clim <- up.clim %>% mutate(year = as.numeric(year)+1985) %>%
pivot_longer(!year, values_to = "up.pred.clim", names_to = "pixel") %>%
filter(pixel == pxv) %>% dplyr::select(-pixel) %>%
filter(year != 1986) # remove first year (true value, not part of the forecast)
# observed
Ndat <- obs %>% as.data.frame() %>% rownames_to_column("year") %>%
pivot_longer(!year, values_to = "obs", names_to = "pixel") %>%
filter(pixel == px) %>%
mutate(year = as.numeric(year)+1985) %>%
dplyr::select(-pixel)
# combine predictions and observations into one dataframe
plot.dat <- left_join(Ndat, med) %>% left_join(.,low) %>% left_join(.,up) %>% left_join(.,up.clim) %>% left_join(.,low.clim) %>% left_join(.,med.clim)
## plot
# color palette
cols = c('base' = '#F8766D', 'climate-only' = '#00BFC4')
(plot.dat %>%
ggplot(aes(x = year, y = obs)) +
geom_point(aes(x = year, y = obs, shape = "observations"), fill = 'black') + geom_line(aes(x = year, y = obs), lty = 2) +
geom_ribbon(aes(ymin = low.pred.base, ymax = up.pred.base, fill = "base"),
alpha=0.4) +
geom_ribbon(aes(ymin = low.pred.clim, ymax = up.pred.clim, fill = "climate-only"),
alpha=0.3) +
geom_line(aes(x = year, y = med.pred.base, col = "base"), lwd = 1.5) +
geom_line(aes(x = year, y = med.pred.clim, col = "climate-only"), lwd = 1.5) +
scale_y_continuous(limits = c(-5, 30)) +
scale_color_manual(name = '', values = cols) +
scale_fill_manual(name = '', values = cols) +
scale_shape_manual(name = '', values = 21, labels = 'observations') +
labs(x = "YEAR", y = "TREE COVER (%)") +
theme(
legend.justification = c("right", "top"),
legend.position = c(.99, .99),
legend.title=element_blank(),
legend.spacing.y = unit(-.2, 'cm'),
legend.box.margin = margin(4,4,4,4),
legend.key=element_blank(),
legend.key.size = unit(0.75, 'cm'),
legend.text=element_text(size=13),
text = element_text(size=18),
panel.background = element_rect(linetype = "solid",fill = NA),
panel.border = element_rect(linetype = "solid", fill = NA))
)
}
# test plot function for a given pixel
plot_pix_gg(707, N)
# plot low, medium, and high cover all-together
plot_grid(plot_pix_gg(707, N),
plot_pix_gg(152, N) + theme(legend.position = "none") + labs(y = ''),
plot_pix_gg(120, N) + theme(legend.position = "none") + labs(y = ''), ncol = 3)
ggsave("R:/Shriver_Lab/PJspread/evaluate_out_of_sample/35y_insample_predictions/single_pixel_low_mid_high_cover_5yr_avg_init.png", plot = last_plot(), dpi = 400)
head(dat)
length(unique(dat$iteration))
View(dat)
## **** Create table of all rmse values
dat %>% filter(model==base) %>% select(rmse) %>% median()
## **** Create table of all rmse values
dat %>% filter(model=="base") %>% select(rmse) %>% median()
## **** Create table of all rmse values
dat %>% filter(model=="base") %>% select(rmse) %>% median(.)
class(dat$rmse)
## **** Create table of all rmse values
dat %>% filter(model=="base") %>% median(mrse)
## **** Create table of all rmse values
dat %>% filter(model=="base") %>% median(rmse)
## **** Create table of all rmse values
# base
dat %>% filter(model=="base") %>% pull(rmse) %>% median(.)
## **** Create table of all rmse values
# base
dat %>%
group_by(model,year_int) %>%
summarise(median = median(rmse), n = n())
## **** Create table of all rmse values
# base
test <- dat %>%
group_by(model,year_int) %>%
summarise(median = median(rmse), n = n())
View(test)
## **** Create table of all rmse values
# N
test <- dat %>%
group_by(model,year_int) %>%
summarise(median = median(rmse, na.rm = T), n = n())
## **** Create table of all rmse values
# N
test <- dat %>%
group_by(model,year_int) %>%
summarise(median = median(rmse, na.rm = T), lower_ci = quantile(rmse, na.rm = T, 0.05))
View(test)
## **** Create table of all rmse values
# N
N.rmse.35y <- dat %>%
group_by(model,year_int) %>%
summarise(median = median(rmse, na.rm = T), lower_ci = quantile(rmse, na.rm = T, 0.05), upper_ci = quantile(rmse, na.rm = T, 0.95))
View(N.rmse.35y)
dat %>% filter(model=="topoclim") %>% filter(year_int=="7") %>% pull(rmse) %>% median()
dat %>% filter(model=="topoclim") %>% filter(year_int=="7") %>% pull(rmse) %>% median(na.rm = T)
dat %>% filter(model=="topoclim") %>% filter(year_int=="7") %>% pull(rmse) %>% quantile(na.rm = T, 0.95)
dat %>% filter(model=="clim") %>% filter(year_int=="5") %>% pull(rmse) %>% quantile(na.rm = T, 0.95)
write.csv(N.rmse.35y,"R:/Shriver_Lab/PJspread/evaluate_out_of_sample/35y_insample_predictions/rmses_for_model_studyarea_comparisons/in_sample_35y_nrmse_yearchunks.csv")
## **** Create table of all rmse values
rmse.35y <- dat %>%
#group_by(model,year_int) %>%
group_by(model,year) %>%
summarise(median = median(rmse, na.rm = T), lower_ci = quantile(rmse, na.rm = T, 0.05), upper_ci = quantile(rmse, na.rm = T, 0.95))
View(rmse.35y)
## **** Create table of all rmse values
rmse.35y <- dat %>%
#group_by(model,year_int) %>%
group_by(model) %>%
summarise(median = median(rmse, na.rm = T), lower_ci = quantile(rmse, na.rm = T, 0.05), upper_ci = quantile(rmse, na.rm = T, 0.95))
View(rmse.35y)
write.csv(rmse.35y,"R:/Shriver_Lab/PJspread/evaluate_out_of_sample/35y_insample_predictions/rmses_for_model_studyarea_comparisons/in_sample_35y_nrmse_avg_allyears.csv")
saveRDS(
plot_grid(plot_pix_gg(707, N),
plot_pix_gg(152, N) + theme(legend.position = "none") + labs(y = ''),
plot_pix_gg(120, N) + theme(legend.position = "none") + labs(y = ''), ncol = 3), "R:/Shriver_Lab/PJspread/evaluate_out_of_sample/35y_insample_predictions/single_pixel_low_mid_high_cover_5yr_avg_init.rds")
load("R:/Shriver_Lab/PJspread/evaluate_out_of_sample/35y_OOS_1_near_predictions/35y_OOS_1_near_predictions_5y_average_initial.RData")
# load libraries
library(tidyverse)
library(cowplot)
# load functions
normalized_rmse <- function(rmsedat, N) {
nrmse <- rmsedat/(max(N)-min(N))
return(nrmse)
}
# N2
BASE = for.base.N2$rmseTotOut
TOPO = for.topo.N2$rmseTotOut
CLIM = for.clim.N2$rmseTotOut
TOPOCLIM = for.topoclim.N2$rmseTotOut
# Plot RMSE across 5 year intervals
plot_rmse <- function(dat,N) {
dat %>% normalized_rmse(.,N) %>% as.data.frame() %>% mutate('year' = seq(1,36,1)) %>%
pivot_longer(starts_with('V'), values_to = 'yearly_rmse', names_to = 'iteration') %>%
filter(year != 1) %>%
mutate(year_int = if_else(year<7,1,
if_else(year<12, 2,
if_else(year<17, 3,
if_else(year<22, 4,
if_else(year<27, 5,
if_else(year<32, 6, 7))))))) %>%
ggplot(aes(x = year_int, y = yearly_rmse, group = year_int)) +
geom_boxplot(col = 'aquamarine3', outlier.shape = NA) +
labs(y = 'RMSE', x = "5 year chunks out") +
theme_bw()
}
# ---------- PLOT RMSE'S ACROSS MODELS TOGETHER ----------
## Plot base and climate RMSE's together
obs = N2 # study area here
# base dataframe of rmse's
base <- BASE %>% normalized_rmse(.,obs) %>% as.data.frame() %>%
mutate('year' = seq(1,36,1)) %>%
pivot_longer(starts_with('V'), values_to = 'base', names_to = 'iteration') %>%
filter(year != 1) %>%
mutate(year_int = if_else(year<7,1,
if_else(year<12, 2,
if_else(year<17, 3,
if_else(year<22, 4,
if_else(year<27, 5,
if_else(year<32, 6, 7)))))))
# climate dataframe of rmse
clim <- CLIM %>% normalized_rmse(.,obs) %>% as.data.frame() %>%
mutate('year' = seq(1,36,1)) %>%
pivot_longer(starts_with('V'), values_to = 'clim', names_to = 'iteration') %>%
filter(year != 1) %>%
mutate(year_int = if_else(year<7,1,
if_else(year<12, 2,
if_else(year<17, 3,
if_else(year<22, 4,
if_else(year<27, 5,
if_else(year<32, 6, 7)))))))
# topo dataframe of rmse
topo <- TOPO %>% normalized_rmse(.,obs) %>% as.data.frame() %>%
mutate('year' = seq(1,36,1)) %>%
pivot_longer(starts_with('V'), values_to = 'topo', names_to = 'iteration') %>%
filter(year != 1) %>%
mutate(year_int = if_else(year<7,1,
if_else(year<12, 2,
if_else(year<17, 3,
if_else(year<22, 4,
if_else(year<27, 5,
if_else(year<32, 6, 7)))))))
# topo dataframe of rmse
topoclim <- TOPOCLIM %>% normalized_rmse(.,obs) %>% as.data.frame() %>%
mutate('year' = seq(1,36,1)) %>%
pivot_longer(starts_with('V'), values_to = 'topoclim', names_to = 'iteration') %>%
filter(year != 1) %>%
mutate(year_int = if_else(year<7,1,
if_else(year<12, 2,
if_else(year<17, 3,
if_else(year<22, 4,
if_else(year<27, 5,
if_else(year<32, 6, 7)))))))
# combine rmse dataframes
dat <- base %>% full_join(., clim) %>%
full_join(., topo) %>%
full_join(., topoclim) %>%
pivot_longer(c(base, clim, topo, topoclim), names_to = 'model',
values_to = 'rmse') %>%
# pivot_longer(c(base, clim), names_to = 'model', values_to = 'rmse') %>%
mutate(year_int = as.factor(year_int))
# colors
group.cols <- c("#F8766D","#00BFC4","#C77Cff","#7CAE00")
(rmse.plot <- dat %>%
ggplot(aes(x = year_int, y = rmse, col = model), col = cols) +
geom_boxplot(outlier.shape = NA) +
labs(y = 'NRMSE', x = "5 year chunks out") +
scale_y_continuous(limits = c(0, 0.6)) +
scale_color_manual(values=group.cols) +
theme_bw()) # NA's are just the shorter length of one of the models
# models that work
plot_rmse(BASE, N2)
plot_rmse(CLIM, N2)
# models that don't (for all areas)
plot_rmse(TOPOCLIM, N2)
plot_rmse(TOPO, N2)
# N2
BASE = for.base.N2$rmseTotOut
TOPO = for.topo.N2$rmseTotOut
CLIM = for.clim.N2$rmseTotOut
TOPOCLIM = for.topoclim.N2$rmseTotOut
# ---------- PLOT RMSE'S ACROSS MODELS TOGETHER ----------
## Plot base and climate RMSE's together
obs = N2 # study area here
# base dataframe of rmse's
base <- BASE %>% normalized_rmse(.,obs) %>% as.data.frame() %>%
mutate('year' = seq(1,36,1)) %>%
pivot_longer(starts_with('V'), values_to = 'base', names_to = 'iteration') %>%
filter(year != 1) %>%
mutate(year_int = if_else(year<7,1,
if_else(year<12, 2,
if_else(year<17, 3,
if_else(year<22, 4,
if_else(year<27, 5,
if_else(year<32, 6, 7)))))))
# climate dataframe of rmse
clim <- CLIM %>% normalized_rmse(.,obs) %>% as.data.frame() %>%
mutate('year' = seq(1,36,1)) %>%
pivot_longer(starts_with('V'), values_to = 'clim', names_to = 'iteration') %>%
filter(year != 1) %>%
mutate(year_int = if_else(year<7,1,
if_else(year<12, 2,
if_else(year<17, 3,
if_else(year<22, 4,
if_else(year<27, 5,
if_else(year<32, 6, 7)))))))
# topo dataframe of rmse
topo <- TOPO %>% normalized_rmse(.,obs) %>% as.data.frame() %>%
mutate('year' = seq(1,36,1)) %>%
pivot_longer(starts_with('V'), values_to = 'topo', names_to = 'iteration') %>%
filter(year != 1) %>%
mutate(year_int = if_else(year<7,1,
if_else(year<12, 2,
if_else(year<17, 3,
if_else(year<22, 4,
if_else(year<27, 5,
if_else(year<32, 6, 7)))))))
# topo dataframe of rmse
topoclim <- TOPOCLIM %>% normalized_rmse(.,obs) %>% as.data.frame() %>%
mutate('year' = seq(1,36,1)) %>%
pivot_longer(starts_with('V'), values_to = 'topoclim', names_to = 'iteration') %>%
filter(year != 1) %>%
mutate(year_int = if_else(year<7,1,
if_else(year<12, 2,
if_else(year<17, 3,
if_else(year<22, 4,
if_else(year<27, 5,
if_else(year<32, 6, 7)))))))
# combine rmse dataframes
dat <- base %>% full_join(., clim) %>%
full_join(., topo) %>%
full_join(., topoclim) %>%
pivot_longer(c(base, clim, topo, topoclim), names_to = 'model',
values_to = 'rmse') %>%
# pivot_longer(c(base, clim), names_to = 'model', values_to = 'rmse') %>%
mutate(year_int = as.factor(year_int))
# colors
group.cols <- c("#F8766D","#00BFC4","#C77Cff","#7CAE00")
(rmse.plot <- dat %>%
ggplot(aes(x = year_int, y = rmse, col = model), col = cols) +
geom_boxplot(outlier.shape = NA) +
labs(y = 'NRMSE', x = "5 year chunks out") +
scale_y_continuous(limits = c(0, 0.6)) +
scale_color_manual(values=group.cols) +
theme_bw()) # NA's are just the shorter length of one of the models
View(topo)
# models that don't (for all areas)
plot_rmse(TOPOCLIM, N2)
oos1 <- readRDS("R:/Shriver_Lab/PJspread/evaluate_out_of_sample/35y_OOS_1_near_predictions/rmse_5yr_chunks_5y_avg_init_reletavized_rm_negatives_topos_only.rds.rds")
oos1 <- readRDS("R:/Shriver_Lab/PJspread/evaluate_out_of_sample/35y_OOS_1_near_predictions/rmse_5yr_chunks_5y_avg_init_reletavized_rm_negatives_topos_only.rds")
oos2 <- readRDS("R:/Shriver_Lab/PJspread/evaluate_out_of_sample/35y_OOS_2_far_predictions/rmse_5yr_chunks_5y_avg_init_reletavized_rm_negatives_topos_only.rds")
plot_grid(oos1 + theme(legend.position="none") + labs(y = ''), oos2 + labs(y = ''), ncol = 2, rel_widths = c(1,1.4),labels = c('A', 'B'))
# save to server
ggsave("R:/Shriver_Lab/PJspread/figures/rmse_5yr_chunks_5y_avg_init_reletavized_rm_negatives_topos_only.png", plot = last_plot(), width = 6, height = 4, dpi = 400)
