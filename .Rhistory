load("R:/Shriver_Lab/PJspread/evaluate_in_sample/eval_model_insample_5y.RData")
# ---------- SUMMARIZE AND PLOT RMSE ------------------
# average rmse functions
average_rmse <- function(mod) {
rmse <- mod$rmseTotOut
to_return <- data.frame(
avg = median(rmse),
low.cred = quantile(rmse, 0.1),
up.cred = quantile(rmse, 0.9))
return(to_return)
}
average_rmse(for.base.N)
average_rmse(for.topo.N)
average_rmse(for.clim.N)
average_rmse(for.topoclim.N)
normalized_rmse <- function(mod) {
rmse <- mod$rmseTotOut
nrmse <- rmse/(max(N)-min(N))
to_return <- data.frame(
avg = median(nrmse),
low.cred = quantile(nrmse, 0.1),
up.cred = quantile(nrmse, 0.9))
return(to_return)
}
normalized_rmse(for.base.N)
normalized_rmse(for.topo.N)
normalized_rmse(for.clim.N)
normalized_rmse(for.topoclim.N)
## plot RMSE
BASE = for.base.N$rmseTotOut
TOPO = for.topo.N$rmseTotOut
CLIM = for.clim.N$rmseTotOut
TOPOCLIM = for.topoclim.N$rmseTotOut
CLIM = c(CLIM, rep(NA, length(BASE) - length(CLIM)))
TOPOCLIM = c(TOPOCLIM, rep(NA, length(BASE) - length(TOPOCLIM)))
rmsedat <- data.frame(BASE, TOPO, CLIM,TOPOCLIM)
rmsedat %>% pivot_longer(everything(), names_to = "model", values_to = "rmse") %>% ggplot(aes(x = model, y = rmse)) + geom_boxplot(fill = c("#00BFC4","#C77Cff","#F8766D","#7CAE00"), outlier.shape = NA, lwd = 1.2, col = "#36454F") + labs(x = "MODEL", y = "RMSE") + theme_bw() + theme(legend.position="none", text = element_text(size=25))
# load packages
library(tidyverse)
library(abind) # arrays
library(spatstat) # distance matrix w/ pairwise dist. function
library(raster)
library(cowplot)
normalized_rmse <- function(mod) {
rmse <- mod$rmseTotOut
nrmse <- rmse/(max(N)-min(N))
to_return <- data.frame(
avg = median(nrmse),
low.cred = quantile(nrmse, 0.1),
up.cred = quantile(nrmse, 0.9))
return(to_return)
}
normalized_rmse(for.base.N)
normalized_rmse(for.topo.N)
normalized_rmse(for.clim.N)
normalized_rmse(for.topoclim.N)
## plot RMSE
BASE = for.base.N$rmseTotOut
TOPO = for.topo.N$rmseTotOut
CLIM = for.clim.N$rmseTotOut
TOPOCLIM = for.topoclim.N$rmseTotOut
CLIM = c(CLIM, rep(NA, length(BASE) - length(CLIM)))
TOPOCLIM = c(TOPOCLIM, rep(NA, length(BASE) - length(TOPOCLIM)))
rmsedat <- data.frame(BASE, TOPO, CLIM,TOPOCLIM)
rmsedat %>% pivot_longer(everything(), names_to = "model", values_to = "rmse") %>% ggplot(aes(x = model, y = rmse)) + geom_boxplot(fill = c("#00BFC4","#C77Cff","#F8766D","#7CAE00"), outlier.shape = NA, lwd = 1.2, col = "#36454F") + labs(x = "MODEL", y = "RMSE") + theme_bw() + theme(legend.position="none", text = element_text(size=25))
max(N)
rmsedat %>% pivot_longer(everything(), names_to = "model", values_to = "rmse") %>%
mutate(rmse = rmse/max(N)) %>% # normalize rmse values by range of observed data
ggplot(aes(x = model, y = rmse)) +
geom_boxplot(fill = c("#00BFC4","#C77Cff","#F8766D","#7CAE00"), outlier.shape = NA, lwd = 1.2, col = "#36454F") +
labs(x = "MODEL", y = "RMSE") +
theme_bw() +
theme(legend.position="none", text = element_text(size=25))
?round
rmsedat %>% pivot_longer(everything(), names_to = "model", values_to = "rmse") %>%
mutate(rmse = round(rmse/max(N)), 3) %>% # normalize rmse values by range of observed data
ggplot(aes(x = model, y = rmse)) +
geom_boxplot(fill = c("#00BFC4","#C77Cff","#F8766D","#7CAE00"), outlier.shape = NA, lwd = 1.2, col = "#36454F") +
labs(x = "MODEL", y = "RMSE") +
theme_bw() +
theme(legend.position="none", text = element_text(size=25))
rmsedat %>% pivot_longer(everything(), names_to = "model", values_to = "rmse") %>%
mutate(rmse = rmse/max(N)) %>% # normalize rmse values by range of observed data
ggplot(aes(x = model, y = rmse)) +
geom_boxplot(fill = c("#00BFC4","#C77Cff","#F8766D","#7CAE00"), outlier.shape = NA, lwd = 1.2, col = "#36454F") +
labs(x = "MODEL", y = "RMSE") +
theme_bw() +
theme(legend.position="none", text = element_text(size=25))
ggsave("R:/Shriver_Lab/PJspread/figures/rmse-plot_insample_5year_forecast_normalized.png", plot = last_plot(), dpi = 600)
ggsave("R:/Shriver_Lab/PJspread/figures/rmse-plot_insample_5year_forecast_normalized.png", plot = last_plot(), dpi = 400)
# plot
# colors
group.cols <- c("#F8766D","#00BFC4","#C77Cff","#7CAE00")
rmsedat %>% pivot_longer(everything(), names_to = "model", values_to = "rmse") %>%
mutate(rmse = rmse/max(N)) %>% # normalize rmse values by range of observed data
ggplot(aes(x = model, y = rmse, col = model)) +
geom_boxplot(outlier.shape = NA, lwd = 1.2) +
scale_color_manual(values=group.cols) +
labs(x = "MODEL", y = "RMSE") +
theme_bw() +
theme(legend.position="none", text = element_text(size=25))
rmsedat %>% pivot_longer(everything(), names_to = "model", values_to = "rmse") %>%
mutate(rmse = rmse/max(N)) %>% # normalize rmse values by range of observed data
ggplot(aes(x = model, y = rmse, col = model)) +
geom_boxplot(outlier.shape = NA, lwd = 1.2) +
scale_color_manual(values=group.cols) +
labs(x = "MODEL", y = "RMSE") +
theme_bw() +
theme(legend.position="none", text = element_text(size=20))
ggsave("R:/Shriver_Lab/PJspread/figures/rmse-plot_insample_5year_forecast_normalized.png", plot = last_plot(), dpi = 400)
# save to Google drive project folder
ggsave("G:/.shortcut-targets-by-id/1FPlPAVacVgAROSPXMiiOGb2Takzm2241/PJ_Photo/cover_spread/Figures/Final_model_run/rmse-plot_insample_5year_forecast_normalized.png", plot = last_plot(), dpi = 400)
dim(for.topo.N$predOut)
matplot(for.topo.N$predOut[,,5000], type = 'l')
matplot(for.topo.N$predOut[,,4000], type = 'l')
matplot(for.topo.N$predOut[,,2000], type = 'l')
max(for.topo.N$predOut)
min(for.topo.N$predOut)
max(for.base.N$predOut)
min(for.base.N$predOut)
med.pred.topo <- apply(for.topo.N$predOut, MARGIN = c(1,2), FUN = median)
up.pred.topo <- apply(for.topo.N$predOut, MARGIN = c(1,2), FUN = quantile, 0.95)
low.pred.topo <- apply(for.topo.N$predOut, MARGIN = c(1,2), FUN = quantile, 0.05)
plot(med.pred.topo[,702])
plot(med.pred.base[,702])
plot(med.pred.topo[,702], type = 'l')
lines(med.pred.base[,702], col = 'green')
plot(med.pred.topo[,702], type = 'l', ylim = c(10,20))
lines(med.pred.base[,702], col = 'green')
lines(N[32:36,702])
plot(med.pred.topo[,702], type = 'l', ylim = c(10,25))
lines(med.pred.base[,702], col = 'green')
lines(N[32:36,702])
# load packages
library(tidyverse)
library(abind) # arrays
library(spatstat) # distance matrix w/ pairwise dist. function
library(raster)
library(cowplot)
# load functions
source("forecastFunctions.R")
load("R:/Shriver_Lab/PJspread/evaluate_out_of_sample/35y_insample_predictions/35y_insample_predictions_5y_average_initial.RData")
max(for.base.N$predOut)
min(for.base.N$predOut)
max(for.topo.N$predOut)
max(for.clim.N$predOut)
min(for.topo.N$predOut)
min(for.clim.N$predOut)
max(for.topoclim.N$predOut)
min(for.topoclim.N$predOut)
matplot(for.topo.N$predOut[,5000], type = l)
matplot(for.topo.N$predOut[,,5000], type = l)
matplot(for.topo.N$predOut[,,5000], type = 'l')
matplot(for.topo.N$predOut[,,3000], type = 'l')
# N
BASE = for.base.N$rmseTotOut
TOPO = for.topo.N$rmseTotOut
CLIM = for.clim.N$rmseTotOut
TOPOCLIM = for.topoclim.N$rmseTotOut
# load functions
normalized_rmse <- function(rmsedat, N) {
nrmse <- rmsedat/(max(N)-min(N))
return(nrmse)
}
# Plot RMSE across 5 year intervals
plot_rmse <- function(dat,N) {
dat %>% normalized_rmse(.,N) %>% as.data.frame() %>% mutate('year' = seq(1,36,1)) %>%
pivot_longer(starts_with('V'), values_to = 'yearly_rmse', names_to = 'iteration') %>%
filter(year != 1) %>%
mutate(year_int = if_else(year<7,1,
if_else(year<12, 2,
if_else(year<17, 3,
if_else(year<22, 4,
if_else(year<27, 5,
if_else(year<32, 6, 7))))))) %>%
ggplot(aes(x = year_int, y = yearly_rmse, group = year_int)) +
geom_boxplot(col = 'aquamarine3', outlier.shape = NA) +
labs(y = 'RMSE', x = "5 year chunks out") +
theme_bw()
}
# models that work
plot_rmse(BASE, N3)
plot_rmse(CLIM, N3)
# models that don't (for all areas)
plot_rmse(TOPOCLIM, N)
plot_rmse(TOPO, N)
# models that work
plot_rmse(BASE, N)
plot_rmse(CLIM, N)
# models that don't (for all areas)
plot_rmse(TOPOCLIM, N)
plot_rmse(TOPO, N)
# ---------- PLOT RMSE'S ACROSS MODELS TOGETHER ----------
## Plot base and climate RMSE's together
obs = N # study area here
# base dataframe of rmse's
base <- BASE %>% normalized_rmse(.,obs) %>% as.data.frame() %>%
mutate('year' = seq(1,36,1)) %>%
pivot_longer(starts_with('V'), values_to = 'base', names_to = 'iteration') %>%
filter(year != 1) %>%
mutate(year_int = if_else(year<7,1,
if_else(year<12, 2,
if_else(year<17, 3,
if_else(year<22, 4,
if_else(year<27, 5,
if_else(year<32, 6, 7)))))))
# climate dataframe of rmse
clim <- CLIM %>% normalized_rmse(.,obs) %>% as.data.frame() %>%
mutate('year' = seq(1,36,1)) %>%
pivot_longer(starts_with('V'), values_to = 'clim', names_to = 'iteration') %>%
filter(year != 1) %>%
mutate(year_int = if_else(year<7,1,
if_else(year<12, 2,
if_else(year<17, 3,
if_else(year<22, 4,
if_else(year<27, 5,
if_else(year<32, 6, 7)))))))
# topo dataframe of rmse
topo <- TOPO %>% normalized_rmse(.,obs) %>% as.data.frame() %>%
mutate('year' = seq(1,36,1)) %>%
pivot_longer(starts_with('V'), values_to = 'topo', names_to = 'iteration') %>%
filter(year != 1) %>%
mutate(year_int = if_else(year<7,1,
if_else(year<12, 2,
if_else(year<17, 3,
if_else(year<22, 4,
if_else(year<27, 5,
if_else(year<32, 6, 7)))))))
# topo dataframe of rmse
topoclim <- TOPOCLIM %>% normalized_rmse(.,obs) %>% as.data.frame() %>%
mutate('year' = seq(1,36,1)) %>%
pivot_longer(starts_with('V'), values_to = 'topoclim', names_to = 'iteration') %>%
filter(year != 1) %>%
mutate(year_int = if_else(year<7,1,
if_else(year<12, 2,
if_else(year<17, 3,
if_else(year<22, 4,
if_else(year<27, 5,
if_else(year<32, 6, 7)))))))
# combine rmse dataframes
dat <- base %>% full_join(., clim) %>%
full_join(., topo) %>%
full_join(., topoclim) %>%
pivot_longer(c(base, clim, topo, topoclim), names_to = 'model',
values_to = 'rmse') %>%
# pivot_longer(c(base, clim), names_to = 'model', values_to = 'rmse') %>%
mutate(year_int = as.factor(year_int))
# combine rmse dataframes
dat <- base %>% full_join(., clim) %>%
full_join(., topo) %>%
full_join(., topoclim) %>%
pivot_longer(c(base, clim, topo, topoclim), names_to = 'model',
values_to = 'rmse') %>%
pivot_longer(c(base, clim), names_to = 'model', values_to = 'rmse') %>%
mutate(year_int = as.factor(year_int))
# combine rmse dataframes
dat <- base %>% full_join(., clim) %>%
full_join(., topo) %>%
full_join(., topoclim) %>%
pivot_longer(c(base, clim, topo, topoclim), names_to = 'model',
values_to = 'rmse') %>%
# pivot_longer(c(base, clim), names_to = 'model', values_to = 'rmse') %>%
mutate(year_int = as.factor(year_int))
# colors
group.cols <- c("#F8766D","#00BFC4","#C77Cff","#7CAE00")
dat %>%
ggplot(aes(x = year_int, y = rmse, col = model), col = cols) +
geom_boxplot(outlier.shape = NA) +
labs(y = 'RMSE', x = "5 year chunks out") +
scale_y_continuous(limits = c(0, 0.6)) +
scale_color_manual(values=group.cols) +
theme_bw() # NA's are just the shorter length of one of the models
dat %>%
ggplot(aes(x = year_int, y = rmse, col = model), col = cols) +
geom_boxplot() + # outlier.shape = NA
labs(y = 'RMSE', x = "5 year chunks out") +
scale_y_continuous(limits = c(0, 0.6)) +
scale_color_manual(values=group.cols) +
theme_bw() # NA's are just the shorter length of one of the models
dat %>%
ggplot(aes(x = year_int, y = rmse, col = model), col = cols) +
geom_boxplot(outlier.shape = NA) +
labs(y = 'RMSE', x = "5 year chunks out") +
scale_y_continuous(limits = c(0, 0.6)) +
scale_color_manual(values=group.cols) +
theme_bw() # NA's are just the shorter length of one of the models
# ------------------ Predicted median and credible intervals ------------
# N
base.pred = for.base.N$predOut
topo.pred = for.topo.N$predOut
clim.pred = for.clim.N$predOut
topoclim.pred = for.topoclim.N$predOut
med.pred.topo <- apply(topo.pred, MARGIN = c(1,2), FUN = median)
low.pred.topo <- apply(topo.pred, MARGIN = c(1,2), FUN = quantile, 0.05) # low
up.pred.topo <- apply(topo.pred, MARGIN = c(1,2), FUN = quantile, 0.95)
matplot(med.pred.topo, type = 'l')
dim(med.pred.topo)
matplot(med.pred.topo[2:36], type = 'l')
matplot(med.pred.topo[2:36,], type = 'l')
matplot(up.pred.topo[2:36,], type = 'l')
matplot(low.pred.topo[2:36,], type = 'l')
